<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="游魂的网络日志">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="//www.shen.ee">
    <!--SEO-->

    <meta name="keywords" content="小程序,云开发,小程序云开发" />


    <meta name="description" content="原文链接
什么是小程序·云开发小程序·云开发是微信团队和腾讯云团队共同研发的一套小程序基础能力，简言之就是：云能力将会成为小程序的基础能力。整套功能是基于腾讯云全新推出的云开发(Tencent ..." />



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />

    <!--Title-->


<title>小程序的全栈开发新时代 | 游魂的网络日志</title>


    <link rel="alternate" href="/atom.xml" title="游魂的网络日志" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
      var cnzz_s_tag = document.createElement('script');
      cnzz_s_tag.type = 'text/javascript';
      cnzz_s_tag.async = true;
      cnzz_s_tag.charset = 'utf-8';
      cnzz_s_tag.src = cnzz_protocol + 'w.cnzz.com/c.php?id=1272902812&async=1';
      var root_s = document.getElementsByTagName('script')[0];
      root_s.parentNode.insertBefore(cnzz_s_tag, root_s);
		</script>
	</div>






    

    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(/./img/banner.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='Andy'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">游魂的网络日志</h2>-->
            
                 <img src="/img/branding.png" alt="游魂的网络日志" class="img-responsive center-block">
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="//www.shen.ee">游魂的网络日志</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>首页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/前端/"><i class="fa "></i>前端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/后端/"><i class="fa "></i>后端</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/工具/"><i class="fa "></i>工具</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/资源/"><i class="fa "></i>资源</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/about/"><i class="fa "></i>关于我</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="小程序的全栈开发新时代">
            
	            小程序的全栈开发新时代
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/前端/">前端</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/云开发/">云开发</a> <a class="tag-link" href="/tags/小程序/">小程序</a> <a class="tag-link" href="/tags/小程序云开发/">小程序云开发</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/09/19</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>1758</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p><a href="https://github.com/lcxfs1991/blog/issues/28" target="_blank" rel="noopener">原文链接</a></p>
<h2 id="什么是小程序·云开发"><a href="#什么是小程序·云开发" class="headerlink" title="什么是小程序·云开发"></a>什么是小程序·云开发</h2><p>小程序·云开发是微信团队和腾讯云团队共同研发的一套小程序基础能力，简言之就是：云能力将会成为小程序的基础能力。整套功能是基于腾讯云全新推出的<a href="https://cloud.tencent.com/product/tcb" target="_blank" rel="noopener">云开发(Tencent Cloud Base)</a>所研发出来的一套完备的小程序后台开发方案。</p>
<p>小程序·云开发为开发者提供完整的云端流程，简化后端开发和运维概念，无需搭建服务器，使用平台提供的 API 进行核心业务开发，即可实现快速上线和迭代。</p>
<p>该解决方案目前提供三大基础能力支持：</p>
<ul>
<li>存储：在小程序前端直接上传/下载云端文件，在小程序云控制台可视化管理</li>
<li>数据库：一个既可在小程序前端操作，也能在云函数中读写的文档型数据库</li>
<li>云函数：在云端运行的代码，微信私有协议天然鉴权，开发者只需编写业务逻辑代码</li>
</ul>
<p>未来，我们还会集成更多的服务能力，为小程序提供更强有力的云端支持。</p>
<h2 id="如何使用小程序·云开发"><a href="#如何使用小程序·云开发" class="headerlink" title="如何使用小程序·云开发"></a>如何使用小程序·云开发</h2><p><img src="https://camo.githubusercontent.com/5301e635289b7b321a3272d4fed572ff41462a25/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f76306367747a736461762e706e67" alt="img"></p>
<p>上面就是小程序·云开发简单的使用图谱：在小程序端，直接用官方提供的接口，在云函数端，直接用官方提供的 Node SDK，就可以操作你云的资源。以前开发小程序所担忧的数据库搭建、文件系统部署，通通没有。</p>
<p>你只需要有在小程序开发 <code>IDE</code> 里面的 <code>云开发</code>，开通一下，填写环境 <code>ID</code>，便可以拥有小程序的云能力！</p>
<p><img src="https://camo.githubusercontent.com/5d683447c8d3454f7fa67c781202543c91a8e891/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f7534616c32356d3575622e706e67" alt="img"></p>
<p><img src="https://camo.githubusercontent.com/be341082d269a742608dd476dae7e36afe2ad07e/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f383533767233666966742e706e67" alt="img"></p>
<p>当然，其实用云开发，并不排斥原有的后台架构，通过下面的架构，你也可以无缝与原有的后台服务兼容，也简化了一些小程序鉴权的逻辑：</p>
<p><img src="https://camo.githubusercontent.com/ef7a8bddff04337b1bcb843dc46c037b7641dc27/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f6e65736c6b36743864722e706e67" alt="img"></p>
<p>接下来，我会分别从小程序端、服务端讲述如何使用这些云资源。</p>
<h2 id="使用云能力"><a href="#使用云能力" class="headerlink" title="使用云能力"></a>使用云能力</h2><h3 id="小程序端"><a href="#小程序端" class="headerlink" title="小程序端"></a>小程序端</h3><p>客户端，这里是指在小程序端中。如果要使用云开发能力，请做以下配置：</p>
<ul>
<li>在 <code>app.json / game.json</code> 中， 中增加字段 <code>&quot;cloud&quot;: true</code></li>
<li>project.config.json 中增加了字段 cloudfunctionRoot 用于指定存放云函数的目录</li>
<li>初始化云开发能力：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line">App(&#123;</span><br><span class="line">  onLaunch: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    wx.cloud.init(&#123;</span><br><span class="line">        traceUser: <span class="literal">true</span> <span class="comment">// 用户信息会显示在云开发控制台的用户面板中</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/init.html" target="_blank" rel="noopener">小程序端初始化能力文档</a></p>
<p>在用户管理中会显示使用云能力的小程序的访问用户列表，默认以访问时间倒叙排列，访问时间的触发点是在小程序端调用 <code>wx.cloud.init</code> 方法，且其中的 <code>traceUser</code> 参数传值为 <code>true</code>。</p>
<h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><p>如果你想在云函数中，操作文件、数据库和云函数资源，你可以使用我们提供的服务端 SDK 进行操作。首先，进入到你的某个云函数中，安装以下依赖包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save tcb-admin-node</span><br></pre></td></tr></table></figure>
<p>在云函数中初始化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化示例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'tcb-admin-node'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化资源</span></span><br><span class="line"><span class="comment">// 云函数下不需要secretId和secretKey。</span></span><br><span class="line"><span class="comment">// env如果不指定将使用默认环境</span></span><br><span class="line">app.init(&#123;</span><br><span class="line">  secretId: <span class="string">'xxxxx'</span>,</span><br><span class="line">  secretKey: <span class="string">'xxxx'</span>, </span><br><span class="line">  env: <span class="string">'xxx'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//云函数下使用默认环境</span></span><br><span class="line">app.init()</span><br><span class="line"></span><br><span class="line"><span class="comment">//云函数下指定环境</span></span><br><span class="line">app.init(&#123;</span><br><span class="line">  env: <span class="string">'xxx'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://cloud.tencent.com/document/product/876/19391" target="_blank" rel="noopener">服务端初始化文档</a></p>
<h2 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h2><p>云开发提供存储空间、上传文件、下载文件、CDN加速文件访问等能力,开发者可以在小程序端与服务端通过 <code>API</code> 使用这些能力。</p>
<h3 id="小程序端-1"><a href="#小程序端-1" class="headerlink" title="小程序端"></a>小程序端</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 选择图片</span></span><br><span class="line">wx.chooseImage(&#123;</span><br><span class="line">    success: <span class="function"><span class="params">dRes</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 上传图片</span></span><br><span class="line">        <span class="keyword">const</span> uploadTask = wx.cloud.uploadFile(&#123;</span><br><span class="line">            cloudPath: <span class="string">`<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>-<span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random(<span class="number">0</span>, <span class="number">1</span>) * <span class="number">10000000</span>)&#125;</span>.png`</span>, <span class="comment">// 随机图片名</span></span><br><span class="line">            filePath: dRes.tempFilePaths[<span class="number">0</span>], <span class="comment">// 本地的图片路径</span></span><br><span class="line">            success: <span class="built_in">console</span>.log,</span><br><span class="line">            fail: <span class="built_in">console</span>.error</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    fail: <span class="built_in">console</span>.error,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/storage/" target="_blank" rel="noopener">小程序端存储文档</a></p>
<h3 id="服务端-1"><a href="#服务端-1" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'tcb-admin-node'</span>);</span><br><span class="line">app.init();</span><br><span class="line"></span><br><span class="line">app.uploadFile(&#123;</span><br><span class="line">    cloudPath: <span class="string">"cover.png"</span>,</span><br><span class="line">    fileContent: fs.createReadStream(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/cover.png`</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;);;</span><br></pre></td></tr></table></figure>
<h3 id="控制台"><a href="#控制台" class="headerlink" title="控制台"></a>控制台</h3><p>上传好的文件，就会出现在控制台中，如下图。你可以在控制台里删除、下载或者查看图片的详情。<br><img src="https://camo.githubusercontent.com/d96ba74fa0d65c073f35a775173058edd057a483/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f6f756935716f766973672e706e67" alt="img">你还可以控文件整体的权限，这里还有一些具体的介绍。<br><img src="https://camo.githubusercontent.com/7973a03cdda8fae0df0305628b99eef864e547f1/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f32386c667674347a73342e706e67" alt="img"></p>
<p><a href="https://cloud.tencent.com/document/product/876/18442" target="_blank" rel="noopener">服务端存储文档</a></p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>小程序云提供文档型数据库 ( document-oriented database )，数据库包含多个集合（相当于关系型数据中的表），集合近似于一个 JSON 数组，数组中的每个对象就是一条记录，记录的格式是 JSON 文档。</p>
<p>每条记录都有一个 <code>_id</code> 字段用以唯一标志这条记录、一个 <code>_openid</code> 字段用以标志记录的创建者，即小程序的用户。开发者可以自定义 <code>_id</code>，但不可在小程序端自定义（在服务端可以） <code>_openid</code> 。<code>_openid</code> 是在文档创建时由系统根据小程序用户默认创建的，开发者可使用其来标识和定位文档。</p>
<p>数据库 <code>API</code> 分为小程序端和服务端两部分，小程序端 <code>API</code> 拥有严格的调用权限控制，开发者可在小程序内直接调用 <code>API</code> 进行非敏感数据的操作。对于有更高安全要求的数据，可在云函数内通过服务端 <code>API</code> 进行操作。云函数的环境是与客户端完全隔离的，在云函数上可以私密且安全的操作数据库。</p>
<p>数据库 <code>API</code> 包含增删改查的能力，使用 <code>API</code> 操作数据库只需三步：获取数据库引用、构造查询/更新条件、发出请求。切记，在操作数据库前，请先在控制台中创建 <code>collection</code>。</p>
<h3 id="小程序端-2"><a href="#小程序端-2" class="headerlink" title="小程序端"></a>小程序端</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = wx.cloud.database();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入数据</span></span><br><span class="line">db.collection(<span class="string">'photo'</span>).add(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        photo: <span class="string">'cloud://tcb-xxx/05ca1d38f86f90d66d4751a730379dfa6584dde05ab4-Ma9vMN_fw658.jpg'</span>,</span><br><span class="line">        title: <span class="string">'风景'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取数据</span></span><br><span class="line">db.collection(<span class="string">'photo'</span>).get().then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = res.data;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// 在小程序端， _openid 会自动插入到数据库中</span></span><br><span class="line">&#123;</span><br><span class="line">    photo: <span class="string">'cloud://tcb-xxx/05ca1d38f86f90d66d4751a730379dfa6584dde05ab4-Ma9vMN_fw658.jpg'</span>,</span><br><span class="line">    title: <span class="string">'风景'</span>,</span><br><span class="line">    _openid: <span class="string">'oLlMr5FICCQJV-QgVLVzKu1212341'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/database/" target="_blank" rel="noopener">小程序端数据库文档</a></p>
<h3 id="服务端-2"><a href="#服务端-2" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'tcb-admin-node'</span>);</span><br><span class="line">app.init();</span><br><span class="line"><span class="keyword">const</span> db = app.database();</span><br><span class="line"></span><br><span class="line">db.collection(<span class="string">'photo'</span>).limit(<span class="number">10</span>).get().then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// 因为是在服务端，其它用户的也可以提取出来</span></span><br><span class="line">&#123;</span><br><span class="line">    photo: <span class="string">'cloud://tcb-xxx/05ca1d38f86f90d66d4751a730379dfa6584dde05ab4-Ma9vMN_fw658.jpg'</span>,</span><br><span class="line">    title: <span class="string">'风景'</span>,</span><br><span class="line">    _openid: <span class="string">'oLlMr5FICCQJV-QgVLVzKu1342121'</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    photo: <span class="string">'cloud://tcb-xxx/0dc3e66fd6b53641e328e091ccb3b9c4e53874232e6bf-ZxSfee_fw658.jpg'</span>,</span><br><span class="line">    title: <span class="string">'美女'</span>,</span><br><span class="line">    _openid: <span class="string">'DFDFEX343xxdf-QgVLVzKu12452121'</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    photo: <span class="string">'cloud://tcb-xxx/104b27e339bdc93c0da15a47aa546b6e9c0e3359c315-L8Px2Y_fw658.jpg'</span>,</span><br><span class="line">    title: <span class="string">'动物'</span>,</span><br><span class="line">    _openid: <span class="string">'DFDFEX343xxdf-QgVLVzKu1342121'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://cloud.tencent.com/document/product/876/18441" target="_blank" rel="noopener">服务端数据库文档</a></p>
<h3 id="控制台-1"><a href="#控制台-1" class="headerlink" title="控制台"></a>控制台</h3><p>可以在控制台里，看到用户操作的数据，你也可以自己在控制台上添加、更新或删除数据。<br><img src="https://camo.githubusercontent.com/b7e54414860c77536b6431c4a9f5292fbc112281/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f30746e6e79616a7a65642e706e67" alt="img"></p>
<p>如果数据量庞大，可以设置索引提供查询的效率。<br><img src="https://camo.githubusercontent.com/f45ebfc0f8e33db6c059b3d4781ccb4d6b28492f/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f6f727a6363316c7436742e706e67" alt="img"></p>
<p>数据库也可以通过设置权限，管控每个 <code>collection</code>。<br><img src="https://camo.githubusercontent.com/6184ef5aa5490e2c4517a82c3727bf85c40405b0/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f6a7169663266363964772e706e67" alt="img"></p>
<h2 id="云函数"><a href="#云函数" class="headerlink" title="云函数"></a>云函数</h2><p>云函数是一段运行在云端的代码，无需管理服务器，在开发工具内一键上传部署即可运行后端代码。</p>
<p>开发者可以在云函数内获取到每次调用的上下文（<code>appid</code>、<code>openid</code> 等），无需维护复杂的鉴权机制，即可获取天然可信任的用户登录态（<code>openid</code>）。</p>
<h3 id="小程序端-3"><a href="#小程序端-3" class="headerlink" title="小程序端"></a>小程序端</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wx.cloud.callFunction(&#123;</span><br><span class="line">    name: <span class="string">'addblog'</span>, <span class="comment">// 云函数名称</span></span><br><span class="line">    data: &#123; <span class="comment">// 传到云函数处理的参数</span></span><br><span class="line">        title: <span class="string">'云开发 TCB'</span>,</span><br><span class="line">        content: <span class="string">'存储、数据库存、云函数'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/functions/" target="_blank" rel="noopener">小程序端云函数文档</a></p>
<h3 id="服务端-3"><a href="#服务端-3" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">"tcb-admin-node"</span>);</span><br><span class="line">app.init();</span><br><span class="line"></span><br><span class="line">app.callFunction(&#123;</span><br><span class="line">    name: <span class="string">'addblog'</span>, <span class="comment">// 云函数名称</span></span><br><span class="line">    data: &#123; <span class="comment">// 传到云函数处理的参数</span></span><br><span class="line">        title: <span class="string">'云开发 TCB'</span>,</span><br><span class="line">        content: <span class="string">'存储、数据库存、云函数'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://cloud.tencent.com/document/product/876/18440" target="_blank" rel="noopener">服务端云函数文档</a></p>
<h3 id="控制台-2"><a href="#控制台-2" class="headerlink" title="控制台"></a>控制台</h3><p>上传好之后的云函数，都会在这里罗列出来。<br><img src="https://camo.githubusercontent.com/ba5723b2a3130576b1d1a3d8cb35ba21dc990827/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f627165787630773369692e706e67" alt="img"></p>
<p>每次调用云函数，都可以在这里看到日志，还可以构造测试的参数，用于调试。<br><img src="https://camo.githubusercontent.com/49e36685fcb3f9a39937b11ad26fd9433b529fed/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f746332706d3476796e662e706e67" alt="img"></p>
<h2 id="语法糖"><a href="#语法糖" class="headerlink" title="语法糖"></a>语法糖</h2><p>大部份的接口，目前都支持两种写法，分别是Promise 和 Async/Await，本节以 <code>callFunction</code> 作为例子，在<code>云函数</code>中介绍这两种写法。 <code>Async/Awai</code>t 本质上是基于 <code>Promise</code> 的一种语法糖，它只是把 <code>Promise</code> 转换成同步的写法而已。</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">"tcb-admin-node"</span>);</span><br><span class="line">app.init();</span><br><span class="line"></span><br><span class="line">exports.main = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    app.callFunction(&#123;</span><br><span class="line">        name: <span class="string">'addblog'</span>, <span class="comment">// 云函数名称</span></span><br><span class="line">        data: &#123; <span class="comment">// 传到云函数处理的参数</span></span><br><span class="line">            title: <span class="string">'云开发 TCB'</span>,</span><br><span class="line">            content: <span class="string">'存储、数据库存、云函数'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">        callback(<span class="literal">null</span>, res.data);</span><br><span class="line">    &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        callback(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">"tcb-admin-node"</span>);</span><br><span class="line">app.init();</span><br><span class="line"></span><br><span class="line">exports.main = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        result = <span class="keyword">await</span> app.callFunction(&#123;</span><br><span class="line">            name: <span class="string">'addblog'</span>, <span class="comment">// 云函数名称</span></span><br><span class="line">            data: &#123; <span class="comment">// 传到云函数处理的参数</span></span><br><span class="line">                title: <span class="string">'云开发 TCB'</span>,</span><br><span class="line">                content: <span class="string">'存储、数据库存、云函数'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在云函数里使用，由于是 <code>Node 8.9</code> 或以上的环境，因此天然支持 <code>Async/Await</code> 诘法，但在小程端要使用的话，需要额外引入 <code>Polyfill</code>，比如这个开源的项目：<a href="https://github.com/facebook/regenerator/blob/master/packages/regenerator-runtime/runtime.js" target="_blank" rel="noopener">regenerator</a></p>
<h2 id="开发者资源"><a href="#开发者资源" class="headerlink" title="开发者资源"></a>开发者资源</h2><p>由于小程序·云开发是基于腾讯云的云开发开发的功能，因此在腾讯云与小程序两边都有不少的开发者资源，这里供大家参阅读：</p>
<ul>
<li><a href="https://cloud.tencent.com/document/product/876" target="_blank" rel="noopener">腾讯云开发者资源及文档</a></li>
<li><a href="https://github.com/TencentCloudBase" target="_blank" rel="noopener">腾讯云云开发平台官方 Github</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html" target="_blank" rel="noopener">微信小程序·云开发文档</a></li>
</ul>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">游魂的网络日志</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/article/52925.html" class="pre-post btn btn-default" title='手把手教你搭建一个属于自己的网站'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">手把手教你搭建一个属于自己的网站</span>
        </a>
    
    
        <a href="/article/24455.html" class="next-post btn btn-default" title='Jenkins配合github实现前端项目自动化构建部署'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Jenkins配合github实现前端项目自动化构建部署</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	<link rel="stylesheet" href="https://cdn.bootcss.com/gitalk/1.4.1/gitalk.min.css">
<script src="//cdn.bootcss.com/gitalk/1.4.1/gitalk.min.js"></script>
<script src="//cdn.bootcss.com/blueimp-md5/2.9.0/js/md5.min.js"></script>

<div id="gitalk-container"></div>
<script type="text/javascript">
    var pathArr = location.pathname.split("/");
    var pathId = pathArr[pathArr.length-1];
    var gitalk = new Gitalk({
        // Gitalk配置
        language: "zh-CN",
        clientID: "7f009ecacf6f9ef23c4f",
        clientSecret: "37f121ac84806a529cfb6f410e86b869384ecc56",
        repo: "youhunwl.github.io",
        owner: "youhunwl",
        admin: ["youhunwl"],
        id: md5(location.pathname),
        distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
</script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是小程序·云开发"><span class="toc-text">什么是小程序·云开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何使用小程序·云开发"><span class="toc-text">如何使用小程序·云开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用云能力"><span class="toc-text">使用云能力</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#小程序端"><span class="toc-text">小程序端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端"><span class="toc-text">服务端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#存储"><span class="toc-text">存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#小程序端-1"><span class="toc-text">小程序端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端-1"><span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制台"><span class="toc-text">控制台</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库"><span class="toc-text">数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#小程序端-2"><span class="toc-text">小程序端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端-2"><span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制台-1"><span class="toc-text">控制台</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#云函数"><span class="toc-text">云函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#小程序端-3"><span class="toc-text">小程序端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端-3"><span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制台-2"><span class="toc-text">控制台</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#语法糖"><span class="toc-text">语法糖</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Promise"><span class="toc-text">Promise</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Async-Await"><span class="toc-text">Async/Await</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发者资源"><span class="toc-text">开发者资源</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2017 - 2022
                </span> |
                <span>
            		<a href="//www.shen.ee" class="copyright-links" target="_blank">游魂的网络日志</a>
        	</span>
            </div>
        </div>
    </div>
</div>




    <script src="/assets/tagcanvas.min.js?rev=2.9"></script>
    <script>
        var tagOption = {
            textColour: '#444', // 字体颜色
            outlineMethod: 'block', // 选中模式
            outlineColour: '#FFDAB9', // 选中模式的颜色
            interval: 30 || 30, // 动画帧之间的时间间隔，值越大，转动幅度越大
            textHeight: 13,
            outlineRadius: 3,
            freezeActive: true || '', // 选中的标签是否继续滚动
            frontSelect: true || '', // 不选标签云后部的标签
            initial: [0.1, -0.1],
            depth: 0.5,
            decel: 0.95,
            maxSpeed: 0.03,
            reverse: true || '', // 是否反向触发
            fadeIn: 500, // 进入动画时间
            wheelZoom: false || '' // 是否启用鼠标滚轮
        }
        TagCanvas.Start('tag-cloud-3d','',tagOption);
    </script>




<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>